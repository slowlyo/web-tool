"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5224],{45224:function(N,O,S){S.r(O),S.d(O,{version:function(){return L}});var a=S(46703);function r(t,n){this._bmap=t,this.dimensions=["lng","lat"],this._mapOffset=[0,0],this._api=n,this._projection=new BMap.MercatorProjection}r.prototype.type="bmap",r.prototype.dimensions=["lng","lat"],r.prototype.setZoom=function(t){this._zoom=t},r.prototype.setCenter=function(t){this._center=this._projection.lngLatToPoint(new BMap.Point(t[0],t[1]))},r.prototype.setMapOffset=function(t){this._mapOffset=t},r.prototype.getBMap=function(){return this._bmap},r.prototype.dataToPoint=function(t){var n=new BMap.Point(t[0],t[1]),e=this._bmap.pointToOverlayPixel(n),i=this._mapOffset;return[e.x-i[0],e.y-i[1]]},r.prototype.pointToData=function(t){var n=this._mapOffset;return t=this._bmap.overlayPixelToPoint({x:t[0]+n[0],y:t[1]+n[1]}),[t.lng,t.lat]},r.prototype.getViewRect=function(){var t=this._api;return new a.graphic.BoundingRect(0,0,t.getWidth(),t.getHeight())},r.prototype.getRoamTransform=function(){return a.matrix.create()},r.prototype.prepareCustoms=function(){var t=this.getViewRect();return{coordSys:{type:"bmap",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:a.util.bind(this.dataToPoint,this),size:a.util.bind(b,this)}}},r.prototype.convertToPixel=function(t,n,e){return this.dataToPoint(e)},r.prototype.convertFromPixel=function(t,n,e){return this.pointToData(e)};function b(t,n){return n=n||[0,0],a.util.map([0,1],function(e){var i=n[e],o=t[e]/2,l=[],c=[];return l[e]=i-o,c[e]=i+o,l[1-e]=c[1-e]=n[1-e],Math.abs(this.dataToPoint(l)[e]-this.dataToPoint(c)[e])},this)}var _;r.dimensions=r.prototype.dimensions;function E(){function t(n){this._root=n}return t.prototype=new BMap.Overlay,t.prototype.initialize=function(n){return n.getPanes().labelPane.appendChild(this._root),this._root},t.prototype.draw=function(){},t}r.create=function(t,n){var e,i=n.getDom();return t.eachComponent("bmap",function(o){var l=n.getZr().painter,c=l.getViewportRoot();if(typeof BMap=="undefined")throw new Error("BMap api is not loaded");if(_=_||E(),e)throw new Error("Only one bmap component can exist");var p;if(!o.__bmap){var s=i.querySelector(".ec-extension-bmap");s&&(c.style.left="0px",c.style.top="0px",i.removeChild(s)),s=document.createElement("div"),s.className="ec-extension-bmap",s.style.cssText="position:absolute;width:100%;height:100%",i.appendChild(s);var f=o.get("mapOptions");f&&(f=a.util.clone(f),delete f.mapType),p=o.__bmap=new BMap.Map(s,f);var w=new _(c);p.addOverlay(w),l.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}p=o.__bmap;var m=o.get("center"),v=o.get("zoom");if(m&&v){var y=p.getCenter(),u=p.getZoom(),h=o.centerOrZoomChanged([y.lng,y.lat],u);if(h){var P=new BMap.Point(m[0],m[1]);p.centerAndZoom(P,v)}}e=new r(p,n),e.setMapOffset(o.__mapOffset||[0,0]),e.setZoom(v),e.setCenter(m),o.coordinateSystem=e}),t.eachSeries(function(o){o.get("coordinateSystem")==="bmap"&&(o.coordinateSystem=e)}),e&&[e]};var z=r;function x(t,n){return t&&n&&t[0]===n[0]&&t[1]===n[1]}var V=a.extendComponentModel({type:"bmap",getBMap:function(){return this.__bmap},setCenterAndZoom:function(t,n){this.option.center=t,this.option.zoom=n},centerOrZoomChanged:function(t,n){var e=this.option;return!(x(t,e.center)&&n===e.zoom)},defaultOption:{center:[104.114129,37.550339],zoom:5,mapStyle:{},mapStyleV2:{},mapOptions:{},roam:!1}});function C(t){for(var n in t)if(t.hasOwnProperty(n))return!1;return!0}var H=a.extendComponentView({type:"bmap",render:function(t,n,e){var i=!0,o=t.getBMap(),l=e.getZr().painter.getViewportRoot(),c=t.coordinateSystem,p=function(P,R){if(!i){var T=l.parentNode.parentNode.parentNode,d=[-parseInt(T.style.left,10)||0,-parseInt(T.style.top,10)||0],g=l.style,Z=d[0]+"px",B=d[1]+"px";g.left!==Z&&(g.left=Z),g.top!==B&&(g.top=B),c.setMapOffset(d),t.__mapOffset=d,e.dispatchAction({type:"bmapRoam",animation:{duration:0}})}};function s(){i||e.dispatchAction({type:"bmapRoam",animation:{duration:0}})}o.removeEventListener("moving",this._oldMoveHandler),o.removeEventListener("moveend",this._oldMoveHandler),o.removeEventListener("zoomend",this._oldZoomEndHandler),o.addEventListener("moving",p),o.addEventListener("moveend",p),o.addEventListener("zoomend",s),this._oldMoveHandler=p,this._oldZoomEndHandler=s;var f=t.get("roam");f&&f!=="scale"?o.enableDragging():o.disableDragging(),f&&f!=="move"?(o.enableScrollWheelZoom(),o.enableDoubleClickZoom(),o.enablePinchToZoom()):(o.disableScrollWheelZoom(),o.disableDoubleClickZoom(),o.disablePinchToZoom());var w=t.__mapStyle,m=t.get("mapStyle")||{},v=JSON.stringify(m);JSON.stringify(w)!==v&&(C(m)||o.setMapStyle(a.util.clone(m)),t.__mapStyle=JSON.parse(v));var y=t.__mapStyle2,u=t.get("mapStyleV2")||{},h=JSON.stringify(u);JSON.stringify(y)!==h&&(C(u)||o.setMapStyleV2(a.util.clone(u)),t.__mapStyle2=JSON.parse(h)),i=!1}});a.registerCoordinateSystem("bmap",z),a.registerAction({type:"bmapRoam",event:"bmapRoam",update:"updateLayout"},function(t,n){n.eachComponent("bmap",function(e){var i=e.getBMap(),o=i.getCenter();e.setCenterAndZoom([o.lng,o.lat],i.getZoom())})});var L="1.0.0"}}]);
